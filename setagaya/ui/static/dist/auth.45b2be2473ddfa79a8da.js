/*! For license information please see auth.45b2be2473ddfa79a8da.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function s(t,i,o,a){var s=i&&i.prototype instanceof c?i:c,l=Object.create(s.prototype);return n(l,"_invoke",function(t,n,i){var o,a,s,c=0,l=i||[],m=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return o=t,a=0,s=e,f.n=n,u}};function h(t,n){for(a=t,s=n,r=0;!m&&c&&!i&&r<l.length;r++){var i,o=l[r],h=f.p,d=o[2];t>3?(i=d===n)&&(s=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=h&&((i=t<2&&h<o[1])?(a=0,f.v=n,f.n=o[1]):h<d&&(i=t<3||o[0]>n||n>d)&&(o[4]=t,o[5]=n,f.n=d,a=0))}if(i||t>1)return u;throw m=!0,n}return function(i,l,d){if(c>1)throw TypeError("Generator is already running");for(m&&1===l&&h(l,d),a=l,s=d;(r=a<2?e:s)||!m;){o||(a?a<3?(a>1&&(f.n=-1),h(a,s)):f.n=s:f.v=s);try{if(c=2,o){if(a||(i="next"),r=o[i]){if(!(r=r.call(o,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((r=(m=f.n<0)?s:t.call(n,f))!==u)break}catch(t){o=e,a=1,s=t}finally{c=1}}return{value:r,done:m}}}(t,o,a),!0),l}var u={};function c(){}function l(){}function m(){}r=Object.getPrototypeOf;var f=[][o]?r(r([][o]())):(n(r={},o,function(){return this}),r),h=m.prototype=c.prototype=Object.create(f);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,n(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=m,n(h,"constructor",m),n(m,"constructor",l),l.displayName="GeneratorFunction",n(m,a,"GeneratorFunction"),n(h),n(h,a,"Generator"),n(h,o,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:d}})()}function n(e,t,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}n=function(e,t,r,i){function a(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},n(e,t,r,i)}function r(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,u,"next",e)}function u(e){r(a,i,o,s,u,"throw",e)}s(void 0)})}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.user=null,this.permissions=[],this.roles=[],this.initialized=!1},n=[{key:"init",value:(a=i(t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.initialized){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,this.getCurrentUser();case 2:this.initialized=!0,e.n=4;break;case 3:e.p=3,n=e.v,console.error("Failed to initialize auth manager:",n),"/login"!==window.location.pathname&&this.setDefaultUser();case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return a.apply(this,arguments)})},{key:"getCurrentUser",value:(r=i(t().m(function e(){var n,r,i,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.p=1,e.n=2,axios.get("/api/rbac/me");case 2:n=e.v,this.user=n.data,this.permissions=n.data.permissions||[],this.roles=n.data.roles||[],e.n=4;break;case 3:e.p=3,e.v,r=document.querySelector("[data-account]"),i=document.querySelector("[data-is-admin]"),r&&(this.user={name:r.dataset.account,username:r.dataset.account},i&&"true"===i.dataset.isAdmin?(this.roles=[{name:"administrator",id:1}],this.permissions=this.getAdminPermissions()):(this.roles=[{name:"user",id:2}],this.permissions=this.getUserPermissions()));case 4:return e.a(2,this.user);case 5:throw e.p=5,o=e.v,console.error("Failed to get current user:",o),o;case 6:return e.a(2)}},e,this,[[1,3],[0,5]])})),function(){return r.apply(this,arguments)})},{key:"setDefaultUser",value:function(){this.user={name:"shibuya",username:"shibuya"},this.roles=[{name:"administrator",id:1}],this.permissions=this.getAdminPermissions(),this.initialized=!0}},{key:"getAdminPermissions",value:function(){return[{name:"projects:create"},{name:"projects:read"},{name:"projects:update"},{name:"projects:delete"},{name:"collections:create"},{name:"collections:read"},{name:"collections:update"},{name:"collections:delete"},{name:"plans:create"},{name:"plans:read"},{name:"plans:update"},{name:"plans:delete"},{name:"system:admin"},{name:"users:manage"},{name:"roles:manage"}]}},{key:"getUserPermissions",value:function(){return[{name:"projects:read"},{name:"collections:read"},{name:"plans:read"}]}},{key:"hasPermission",value:function(e){return this.initialized?this.permissions.some(function(t){return t.name===e}):(console.warn("AuthManager not initialized, assuming no permission"),!1)}},{key:"hasRole",value:function(e){return this.initialized?this.roles.some(function(t){return t.name===e}):(console.warn("AuthManager not initialized, assuming no role"),!1)}},{key:"isAdmin",value:function(){return this.hasRole("administrator")||this.hasPermission("system:admin")}},{key:"canManageUsers",value:function(){return this.hasPermission("users:manage")||this.isAdmin()}},{key:"canManageRoles",value:function(){return this.hasPermission("roles:manage")||this.isAdmin()}},{key:"logout",value:function(){this.user=null,this.permissions=[],this.roles=[],this.initialized=!1;var e=document.createElement("form");e.method="POST",e.action="/logout",document.body.appendChild(e),e.submit()}},{key:"canCreate",value:function(e){return this.hasPermission("".concat(e,":create"))}},{key:"canRead",value:function(e){return this.hasPermission("".concat(e,":read"))}},{key:"canUpdate",value:function(e){return this.hasPermission("".concat(e,":update"))}},{key:"canDelete",value:function(e){return this.hasPermission("".concat(e,":delete"))}}],n&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,a}();window.authManager=new s,document.addEventListener("DOMContentLoaded",function(){window.authManager.init().catch(console.error)})})();
//# sourceMappingURL=auth.45b2be2473ddfa79a8da.js.map