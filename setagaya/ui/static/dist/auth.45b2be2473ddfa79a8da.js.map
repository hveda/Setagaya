{"version":3,"file":"auth.45b2be2473ddfa79a8da.js","mappings":"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","sources":["webpack://setagaya/./ui/static/js/auth.js"],"sourcesContent":["// Setagaya Authentication Manager\n// Phase 1: Basic RBAC integration with Alpine.js\n\nclass AuthManager {\n  constructor() {\n    this.user = null;\n    this.permissions = [];\n    this.roles = [];\n    this.initialized = false;\n  }\n\n  async init() {\n    if (this.initialized) return;\n    \n    try {\n      await this.getCurrentUser();\n      this.initialized = true;\n    } catch (error) {\n      console.error('Failed to initialize auth manager:', error);\n      // In no-auth mode, we'll set a default user\n      if (window.location.pathname !== '/login') {\n        this.setDefaultUser();\n      }\n    }\n  }\n\n  async getCurrentUser() {\n    try {\n      // For Phase 1, we'll check if RBAC endpoints are available\n      // If not available, fall back to session-based auth info\n      let response;\n      try {\n        response = await axios.get('/api/rbac/me');\n        this.user = response.data;\n        this.permissions = response.data.permissions || [];\n        this.roles = response.data.roles || [];\n      } catch (rbacError) {\n        // Fallback to basic session info - extract from template context\n        const accountElement = document.querySelector('[data-account]');\n        const isAdminElement = document.querySelector('[data-is-admin]');\n        \n        if (accountElement) {\n          this.user = {\n            name: accountElement.dataset.account,\n            username: accountElement.dataset.account\n          };\n          \n          // Set basic permissions based on admin status\n          const isAdmin = isAdminElement && isAdminElement.dataset.isAdmin === 'true';\n          if (isAdmin) {\n            this.roles = [{ name: 'administrator', id: 1 }];\n            this.permissions = this.getAdminPermissions();\n          } else {\n            this.roles = [{ name: 'user', id: 2 }];\n            this.permissions = this.getUserPermissions();\n          }\n        }\n      }\n      \n      return this.user;\n    } catch (error) {\n      console.error('Failed to get current user:', error);\n      throw error;\n    }\n  }\n\n  setDefaultUser() {\n    // For development with no-auth mode\n    this.user = {\n      name: 'shibuya',\n      username: 'shibuya'\n    };\n    this.roles = [{ name: 'administrator', id: 1 }];\n    this.permissions = this.getAdminPermissions();\n    this.initialized = true;\n  }\n\n  getAdminPermissions() {\n    // Basic admin permissions for Phase 1\n    return [\n      { name: 'projects:create' },\n      { name: 'projects:read' },\n      { name: 'projects:update' },\n      { name: 'projects:delete' },\n      { name: 'collections:create' },\n      { name: 'collections:read' },\n      { name: 'collections:update' },\n      { name: 'collections:delete' },\n      { name: 'plans:create' },\n      { name: 'plans:read' },\n      { name: 'plans:update' },\n      { name: 'plans:delete' },\n      { name: 'system:admin' },\n      { name: 'users:manage' },\n      { name: 'roles:manage' }\n    ];\n  }\n\n  getUserPermissions() {\n    // Basic user permissions for Phase 1\n    return [\n      { name: 'projects:read' },\n      { name: 'collections:read' },\n      { name: 'plans:read' }\n    ];\n  }\n\n  hasPermission(permission) {\n    if (!this.initialized) {\n      console.warn('AuthManager not initialized, assuming no permission');\n      return false;\n    }\n    \n    return this.permissions.some(p => p.name === permission);\n  }\n\n  hasRole(roleName) {\n    if (!this.initialized) {\n      console.warn('AuthManager not initialized, assuming no role');\n      return false;\n    }\n    \n    return this.roles.some(r => r.name === roleName);\n  }\n\n  isAdmin() {\n    return this.hasRole('administrator') || this.hasPermission('system:admin');\n  }\n\n  canManageUsers() {\n    return this.hasPermission('users:manage') || this.isAdmin();\n  }\n\n  canManageRoles() {\n    return this.hasPermission('roles:manage') || this.isAdmin();\n  }\n\n  logout() {\n    this.user = null;\n    this.permissions = [];\n    this.roles = [];\n    this.initialized = false;\n    \n    // Use form-based logout to maintain compatibility\n    const form = document.createElement('form');\n    form.method = 'POST';\n    form.action = '/logout';\n    document.body.appendChild(form);\n    form.submit();\n  }\n\n  // Helper methods for UI components\n  canCreate(resource) {\n    return this.hasPermission(`${resource}:create`);\n  }\n\n  canRead(resource) {\n    return this.hasPermission(`${resource}:read`);\n  }\n\n  canUpdate(resource) {\n    return this.hasPermission(`${resource}:update`);\n  }\n\n  canDelete(resource) {\n    return this.hasPermission(`${resource}:delete`);\n  }\n}\n\n// Global auth manager instance\nwindow.authManager = new AuthManager();\n\n// Initialize on DOM content loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n  window.authManager.init().catch(console.error);\n});"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_defineProperties","_toPropertyKey","key","_typeof","toPrimitive","String","_toPrimitive","AuthManager","_classCallCheck","this","user","permissions","roles","initialized","_init","_callee","_t","_context","getCurrentUser","console","error","window","location","pathname","setDefaultUser","_getCurrentUser","_callee2","response","accountElement","isAdminElement","_t3","_context2","axios","get","data","document","querySelector","name","dataset","account","username","isAdmin","id","getAdminPermissions","getUserPermissions","permission","some","warn","roleName","hasRole","hasPermission","form","createElement","method","action","body","appendChild","submit","resource","concat","authManager","addEventListener","init"],"sourceRoot":""}