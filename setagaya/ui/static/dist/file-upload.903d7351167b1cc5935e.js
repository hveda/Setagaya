/*! For license information please see file-upload.903d7351167b1cc5935e.js.LICENSE.txt */
(()=>{function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function r(){var e,t,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.toStringTag||"@@toStringTag";function s(r,i,a,o){var s=i&&i.prototype instanceof c?i:c,u=Object.create(s.prototype);return n(u,"_invoke",function(r,n,i){var a,o,s,c=0,u=i||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,s=e,d.n=r,l}};function p(r,n){for(o=r,s=n,t=0;!f&&c&&!i&&t<u.length;t++){var i,a=u[t],p=d.p,h=a[2];r>3?(i=h===n)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=r<2&&p<a[1])?(o=0,d.v=n,d.n=a[1]):p<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,d.n=h,o=0))}if(i||r>1)return l;throw f=!0,n}return function(i,u,h){if(c>1)throw TypeError("Generator is already running");for(f&&1===u&&p(u,h),o=u,s=h;(t=o<2?e:s)||!f;){a||(o?o<3?(o>1&&(d.n=-1),p(o,s)):d.n=s:d.v=s);try{if(c=2,a){if(o||(i="next"),t=a[i]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((t=(f=d.n<0)?s:r.call(n,d))!==l)break}catch(t){a=e,o=1,s=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),u}var l={};function c(){}function u(){}function f(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(n(t={},a,function(){return this}),t),p=f.prototype=c.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=f,n(p,"constructor",f),n(f,"constructor",u),u.displayName="GeneratorFunction",n(f,o,"GeneratorFunction"),n(p),n(p,o,"Generator"),n(p,a,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(r=function(){return{w:s,m:h}})()}function n(e,t,r,i){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,i){function o(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},n(e,t,r,i)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,l,"next",e)}function l(e){i(o,n,a,s,l,"throw",e)}s(void 0)})}}window.fileUploadComponent=function(){return{files:[],uploadQueue:[],isDragOver:!1,isUploading:!1,uploadProgress:{},allowedTypes:[".jmx",".jar",".csv",".properties",".txt"],maxFileSize:52428800,errors:[],successMessages:[],init:function(){console.log("File upload component initialized"),this.setupDropHandlers()},setupDropHandlers:function(){var e=this;this.$el.addEventListener("dragover",function(t){t.preventDefault(),e.isDragOver=!0}),this.$el.addEventListener("dragleave",function(t){t.preventDefault(),e.$el.contains(t.relatedTarget)||(e.isDragOver=!1)}),this.$el.addEventListener("drop",function(t){t.preventDefault(),e.isDragOver=!1,e.handleFiles(t.dataTransfer.files)})},handleFiles:function(e){var t=this;this.errors=[],Array.from(e).forEach(function(e){t.validateFile(e)&&t.addFileToQueue(e)})},validateFile:function(e){if(e.size>this.maxFileSize)return this.addError("File ".concat(e.name," is too large. Maximum size is ").concat(this.formatFileSize(this.maxFileSize))),!1;var t="."+e.name.split(".").pop().toLowerCase();return this.allowedTypes.includes(t)?!this.files.some(function(t){return t.name===e.name&&t.size===e.size})||(this.addError("File ".concat(e.name," is already selected")),!1):(this.addError("File ".concat(e.name," has an unsupported format. Allowed types: ").concat(this.allowedTypes.join(", "))),!1)},addFileToQueue:function(e){var t={id:this.generateFileId(),file:e,name:e.name,size:e.size,type:e.type,status:"pending",progress:0,error:null,preview:null};this.files.push(t),this.generateFilePreview(t)},generateFilePreview:function(e){return a(r().m(function t(){var n;return r().w(function(t){for(;;)switch(t.n){case 0:if(e.file.type.startsWith("text/")||e.name.endsWith(".jmx"))try{(n=new FileReader).onload=function(t){e.preview=t.target.result.substring(0,500)+(t.target.result.length>500?"...":"")},n.readAsText(e.file)}catch(t){console.log("Could not generate preview for",e.name)}case 1:return t.a(2)}},t)}))()},uploadFiles:function(){var t=this;return a(r().m(function n(){var i,a,o,s,l;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:if(0!==t.files.length){r.n=1;break}return t.addError("No files selected"),r.a(2);case 1:if(window.authManager.hasPermission("files:upload")){r.n=2;break}return t.addError("You do not have permission to upload files"),r.a(2);case 2:t.isUploading=!0,t.errors=[],t.successMessages=[],i=t.files.filter(function(e){return"pending"===e.status}),a=e(i),r.p=3,a.s();case 4:if((o=a.n()).done){r.n=6;break}return s=o.value,r.n=5,t.uploadSingleFile(s);case 5:r.n=4;break;case 6:r.n=8;break;case 7:r.p=7,l=r.v,a.e(l);case 8:return r.p=8,a.f(),r.f(8);case 9:t.isUploading=!1;case 10:return r.a(2)}},n,null,[[3,7,8,9]])}))()},uploadSingleFile:function(e){var t=this;return a(r().m(function n(){var i,a,o,s;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:return e.status="uploading",e.progress=0,(i=new FormData).append("file",e.file),r.p=1,r.n=2,axios.post("/api/files/upload",i,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){e.progress=Math.round(100*t.loaded/t.total)}});case 2:a=r.v,e.status="completed",e.progress=100,t.addSuccess("Successfully uploaded ".concat(e.name)),t.$dispatch("file-uploaded",{file:e,response:a.data}),r.n=4;break;case 3:r.p=3,s=r.v,e.status="error",e.error=(null===(o=s.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.message)||"Upload failed",t.addError("Failed to upload ".concat(e.name,": ").concat(e.error));case 4:return r.a(2)}},n,null,[[1,3]])}))()},removeFile:function(e){var t=this.files.findIndex(function(t){return t.id===e});-1!==t&&this.files.splice(t,1)},clearAll:function(){this.files=[],this.errors=[],this.successMessages=[]},retryUpload:function(e){var t=this.files.find(function(t){return t.id===e});t&&(t.status="pending",t.progress=0,t.error=null)},generateFileId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},formatFileSize:function(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileIcon:function(e){return{jmx:"fas fa-cogs",jar:"fas fa-archive",csv:"fas fa-table",properties:"fas fa-cog",txt:"fas fa-file-alt"}[e.split(".").pop().toLowerCase()]||"fas fa-file"},getStatusIcon:function(e){return{pending:"fas fa-clock text-warning",uploading:"fas fa-spinner fa-spin text-primary",completed:"fas fa-check-circle text-success",error:"fas fa-exclamation-circle text-danger"}[e]||"fas fa-file"},getStatusText:function(e){return{pending:"Pending",uploading:"Uploading...",completed:"Completed",error:"Error"}[e]||"Unknown"},addError:function(e){this.errors.push(e)},addSuccess:function(e){this.successMessages.push(e)},clearMessages:function(){this.errors=[],this.successMessages=[]}}},window.fileManagerComponent=function(){return{files:[],loading:!1,error:null,selectedFiles:new Set,sortBy:"name",sortDirection:"asc",searchTerm:"",currentPage:1,itemsPerPage:20,init:function(){var e=this;return a(r().m(function t(){return r().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.loadFiles();case 1:console.log("File manager initialized");case 2:return t.a(2)}},t)}))()},loadFiles:function(){var e=this;return a(r().m(function t(){var n,i;return r().w(function(t){for(;;)switch(t.p=t.n){case 0:if(window.authManager.hasPermission("files:read")){t.n=1;break}return e.error="You do not have permission to view files",t.a(2);case 1:return t.p=1,e.loading=!0,t.n=2,axios.get("/api/files");case 2:n=t.v,e.files=n.data.files||[],e.error=null,t.n=4;break;case 3:t.p=3,i=t.v,console.error("Failed to load files:",i),e.error="Failed to load files";case 4:return t.p=4,e.loading=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},get filteredFiles(){var e=this,t=this.files;return this.searchTerm&&(t=t.filter(function(t){return t.name.toLowerCase().includes(e.searchTerm.toLowerCase())})),t.sort(function(t,r){var n=t[e.sortBy],i=r[e.sortBy];return"size"===e.sortBy?(n=parseInt(n)||0,i=parseInt(i)||0):"uploaded_at"===e.sortBy&&(n=new Date(n),i=new Date(i)),n<i?"asc"===e.sortDirection?-1:1:n>i?"asc"===e.sortDirection?1:-1:0}),t},get paginatedFiles(){var e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredFiles.slice(e,t)},get totalPages(){return Math.ceil(this.filteredFiles.length/this.itemsPerPage)},setSorting:function(e){this.sortBy===e?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortBy=e,this.sortDirection="asc")},toggleFileSelection:function(e){this.selectedFiles.has(e)?this.selectedFiles.delete(e):this.selectedFiles.add(e)},selectAllFiles:function(){var e=this;this.paginatedFiles.forEach(function(t){e.selectedFiles.add(t.id)})},clearSelection:function(){this.selectedFiles.clear()},deleteFile:function(e){var t=this;return a(r().m(function n(){var i;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:if(window.authManager.hasPermission("files:delete")){r.n=1;break}return alert("You do not have permission to delete files"),r.a(2);case 1:if(confirm("Are you sure you want to delete this file?")){r.n=2;break}return r.a(2);case 2:return r.p=2,r.n=3,axios.delete("/api/files/".concat(e));case 3:return r.n=4,t.loadFiles();case 4:t.selectedFiles.delete(e),r.n=6;break;case 5:r.p=5,i=r.v,console.error("Failed to delete file:",i),alert("Failed to delete file");case 6:return r.a(2)}},n,null,[[2,5]])}))()},deleteSelectedFiles:function(){var t=this;return a(r().m(function n(){var i,a,o,s;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:if(0!==t.selectedFiles.size){r.n=1;break}return alert("No files selected"),r.a(2);case 1:if(confirm("Are you sure you want to delete ".concat(t.selectedFiles.size," selected files?"))){r.n=2;break}return r.a(2);case 2:i=e(t.selectedFiles),r.p=3,i.s();case 4:if((a=i.n()).done){r.n=6;break}return o=a.value,r.n=5,t.deleteFile(o);case 5:r.n=4;break;case 6:r.n=8;break;case 7:r.p=7,s=r.v,i.e(s);case 8:return r.p=8,i.f(),r.f(8);case 9:return r.a(2)}},n,null,[[3,7,8,9]])}))()},downloadFile:function(e,t){if(window.authManager.hasPermission("files:download")){var r=document.createElement("a");r.href="/api/files/".concat(e,"/download"),r.download=t,r.click()}else alert("You do not have permission to download files")},formatFileSize:function(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},formatDate:function(e){return e?new Date(e).toLocaleString():"N/A"},getFileIcon:function(e){return{jmx:"fas fa-cogs text-primary",jar:"fas fa-archive text-warning",csv:"fas fa-table text-success",properties:"fas fa-cog text-info",txt:"fas fa-file-alt text-secondary"}[e.split(".").pop().toLowerCase()]||"fas fa-file"}}},window.filePreviewComponent=function(){return{file:null,content:"",loading:!1,error:null,previewType:"text",showPreview:function(e){var t=this;return a(r().m(function n(){var i,a;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:if(window.authManager.hasPermission("files:read")){r.n=1;break}return t.error="You do not have permission to view files",r.a(2);case 1:return r.p=1,t.loading=!0,t.error=null,r.n=2,axios.get("/api/files/".concat(e));case 2:if(i=r.v,t.file=i.data.file,!t.canPreviewAsText()){r.n=4;break}return r.n=3,t.loadTextContent();case 3:r.n=5;break;case 4:t.previewType="binary";case 5:r.n=7;break;case 6:r.p=6,a=r.v,console.error("Failed to load file preview:",a),t.error="Failed to load file preview";case 7:return r.p=7,t.loading=!1,r.f(7);case 8:return r.a(2)}},n,null,[[1,6,7,8]])}))()},loadTextContent:function(){var e=this;return a(r().m(function t(){var n;return r().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,axios.get("/api/files/".concat(e.file.id,"/content"),{responseType:"text"});case 1:n=t.v,e.content=n.data,e.previewType="text",t.n=3;break;case 2:t.p=2,t.v,e.error="Could not load file content",e.previewType="binary";case 3:return t.a(2)}},t,null,[[0,2]])}))()},canPreviewAsText:function(){if(!this.file)return!1;var e="."+this.file.name.split(".").pop().toLowerCase();return[".jmx",".txt",".properties",".csv",".xml",".json"].includes(e)&&this.file.size<1048576},closePreview:function(){this.file=null,this.content="",this.error=null,this.previewType="text"}}}})();
//# sourceMappingURL=file-upload.903d7351167b1cc5935e.js.map